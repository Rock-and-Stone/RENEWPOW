#include "pch.h"
#include "loadingScene.h"
#include "progressBar.h"

loadingScene::loadingScene()
	: _background(nullptr), 
	_loadingBar(nullptr),
	_currentCount(0)
{
}


loadingScene::~loadingScene()
{
}

HRESULT loadingScene::init()
{
	_background = IMAGEMANAGER->addImage("배경", "source/Images/loadingScene/blackWindow.bmp", WINSIZEX, WINSIZEY, true, MAGENTA);

	/*_loadingBar = new progressBar;
	_loadingBar->init(0, WINSIZEY - 50, WINSIZEX, 50);
	_loadingBar->setGauge(0, 0);*/

	IMAGEMANAGER->addFrameImage("loading", "source/Images/loadingScene/loading.bmp", 822, 62, 3, 1, true, MAGENTA);
	_loadingImg = IMAGEMANAGER->findImage("loading");
	_frameX = 0;
	_count = 0;

	CreateThread(
		NULL,				//스레드 보안속성(자식윈도우 존재할때)
		NULL,				//스레드의 스택크기(0이면 메인쓰레드 동일)
		threadFunction,		//사용할 함수
		this,				//스레드 매개변수(this 로 뒀으니 본 클래스)
		NULL,				//스레드 특성
		NULL);				//스레드 ID

	return S_OK;
}

void loadingScene::release()
{
	SAFE_DELETE(_loadingBar);
}

void loadingScene::update()
{
 /* _loadingBar->update();
  _loadingBar->setGauge(_currentCount, LOADINGMAX);*/

	if (_currentCount == LOADINGMAX)
	{
		//이동할 씬 으로 변경
		SCENEMANAGER->changeScene("mainMenuScene");
	}

	_count++;

	if (_count % 30 == 0)
	{
		_frameX++;
	}
	if (_frameX >= 3) _frameX = 0;
}

void loadingScene::render()
{
	_background->render(getMemDC());
	//_loadingBar->render();
	_loadingImg->frameRender(getMemDC(), 50, WINSIZEY - 100, _frameX, 0);
}

DWORD CALLBACK threadFunction(LPVOID lpParameter)
{
	loadingScene* loadingHelper = (loadingScene*)lpParameter;


	while (loadingHelper->_currentCount != LOADINGMAX)
	{
		//소스 파일 추가
		
		//IMAGEMANAGER->addFrameImage("playerTool", "playerTool.bmp", 96, 16, 6, 0, true, RGB(255, 0, 255)); // 플레이어 도구


		//==================UI 부분 파일 추가 본=====================
		//이미지
		IMAGEMANAGER->addImage("title", "source/images/mainScene/title.bmp", 690, 318, true, MAGENTA);
		IMAGEMANAGER->addImage("mainScene", "source/images/mainScene/mainScene.bmp", WINSIZEX, WINSIZEY, true, MAGENTA);
		IMAGEMANAGER->addFrameImage("start", "source/images/mainScene/start.bmp", 185, 292, 1, 2, true, MAGENTA);
		IMAGEMANAGER->addFrameImage("load", "source/images/mainScene/load.bmp", 185, 292, 1, 2, true, MAGENTA);
		IMAGEMANAGER->addFrameImage("mapTool", "source/images/mainScene/mapTool.bmp", 185, 292, 1, 2, true, MAGENTA);
		IMAGEMANAGER->addFrameImage("exit", "source/images/mainScene/exit.bmp", 185, 292, 1, 2, true, MAGENTA);
		IMAGEMANAGER->addFrameImage("back", "source/images/mainScene/back.bmp", 198, 162, 1, 2, true, MAGENTA);
		

		//사운드
		SOUNDMANAGER->addSound("bugCave", "source/Sounds/bugCave.mp3", true, true);				//동굴 소리
		SOUNDMANAGER->addSound("character", "source/Sounds/character.mp3", true, false);		//띠링 띠리리리리링 소리
		SOUNDMANAGER->addSound("death", "source/Sounds/death.mp3", true, false);				//죽을 때 나는 소리
		SOUNDMANAGER->addSound("doorOpen", "source/Sounds/doorOpen.mp3", true, false);			//문열 때 나는 소리
		SOUNDMANAGER->addSound("springBGM", "source/Sounds/springBGM.mp3", true, true);			//인게임 배경 음악
		SOUNDMANAGER->addSound("fireSpell", "source/Sounds/fireSpell.mp3", true, false);		//용광로 불지피는 소리
		SOUNDMANAGER->addSound("getItem", "source/Sounds/getItem.mp3", true, false);			//아이템 주울 때 나는 소리
		SOUNDMANAGER->addSound("hitGrass", "source/Sounds/hitGrass.mp3", true, false);			//낫으로 풀 벨 때 나는 효과음
		SOUNDMANAGER->addSound("hitRock", "source/Sounds/hitRock.mp3", true, false);			//곡괭이로 돌 때릴 때 나는 효과음
		SOUNDMANAGER->addSound("hitTree", "source/Sounds/hitTree.mp3", true, false);			//도끼로 나무 때릴 때 나는 효과음
		SOUNDMANAGER->addSound("hitPlayer", "source/Sounds/hitPlayer.mp3", true, false);		//공격 할 때 나는 소리
		SOUNDMANAGER->addSound("hoe", "source/Sounds/hoe.mp3", true, false);					//밭 갈때 나는 소리
		SOUNDMANAGER->addSound("menuClose", "source/Sounds/menuClose.mp3", true, false);		//메뉴 닫는 소리
		SOUNDMANAGER->addSound("menuOpen", "source/Sounds/menuOpen.mp3", true, false);			//메뉴 여는 소리
		SOUNDMANAGER->addSound("menuSelect", "source/Sounds/menuSelect.mp3", true, false);		//메뉴 선택 소리
		SOUNDMANAGER->addSound("monsterDead", "source/Sounds/monsterDead.mp3", true, false);	//몬스터 죽는 소리
		SOUNDMANAGER->addSound("moveGrass", "source/Sounds/moveGrass.mp3", true, false);		//풀밭을 걸을 때
		SOUNDMANAGER->addSound("moveRock", "source/Sounds/moveRock.mp3", true, false);			//돌길을 걸을 때
		SOUNDMANAGER->addSound("moveSoil", "source/Sounds/moveSoil.mp3", true, false);			//땅을 걸을 때
		SOUNDMANAGER->addSound("day", "source/Sounds/day.mp3", true, true);						//아침이 될 때 나는 소리
		SOUNDMANAGER->addSound("night", "source/Sounds/night.mp3", true, true);					//밤이 될 때 나는 소리
		SOUNDMANAGER->addSound("opening", "source/Sounds/opening.mp3", true, true);				//오프닝 소리
		SOUNDMANAGER->addSound("pickUpItem", "source/Sounds/pickUpItem.mp3", true, false);		//픽업 아이템(?)
		SOUNDMANAGER->addSound("purchase", "source/Sounds/purchase.mp3", true, false);			//상점 구매 소리
		SOUNDMANAGER->addSound("removeGrass", "source/Sounds/removeGrass.mp3", true, false);	//풀 베는 소리
		SOUNDMANAGER->addSound("removeRock", "source/Sounds/removeRock.mp3", true, false);		//돌 깨는 소리
		SOUNDMANAGER->addSound("removeTree", "source/Sounds/removeTree.mp3", true, false);		//나무 베는 소리
		SOUNDMANAGER->addSound("seeds", "source/Sounds/seeds.mp3", true, false);				//씨앗 심는 소리
		SOUNDMANAGER->addSound("slime", "source/Sounds/slime.mp3", true, false);				//슬라임이 공격할 때 나는 소리
		SOUNDMANAGER->addSound("toolSwap", "source/Sounds/toolSwap.mp3", true, false);			//탭누르면 나는 소리
		SOUNDMANAGER->addSound("watering", "source/Sounds/watering.mp3", true, false);			//물을 담거나 물을 줄 때 나는 소리




		



		loadingHelper->_currentCount++;
	}
	return 0;
}
